[TOC]

#### 基础知识

已知，圣遗物副属性中，$百分比攻击加成:暴击率:暴击伤害$ 平均以 $1.5:1:2$ 的比例给出。

![5星圣遗物副词条的取值范围](https://humoon-image-hosting-service.oss-cn-beijing.aliyuncs.com/img/typora/2022/5星圣遗物副词条的取值范围.jpg)

一般将 5%的攻击加成、3.3%的暴击率、6.6%的暴击伤害、5%的生命加成、6.2%的防御加成、5.5%的充能、20的精通称为一个词条。



#### 建模

不考虑元素反应打纯伤时，为了最大化输出，圣遗物词条最优化分配问题的建模如下：

设基础攻击力为 $a_0$，圣遗物百分比攻击加成为 $b$，圣遗物以外的所有攻击力增加为 $a_f$（圣遗物加的固定攻击可以忽略）。同样的规则适用于暴击率 $cr$ 和暴击伤害 $cd$。**圣遗物词条中双暴和百分比攻击的总词条数为 $C$**，则伤害的最优化问题为：  
$$
\begin{align}
\max & D = a_0 \times \left[ 1 + b + a_f/a_0\right] \times \left[1+(cr_0+cr)\times (cd_0+cd)\right] \tag{1} \\
\text{s.t. } & \frac{b}{5\%} +\frac{cr}{3.3\%} +\frac{cd}{6.6\%} = C \tag{2}
\end{align}
$$

经过简单的换元：$b'=b+a_f/a_0, cr' = cr_0+cr, cd' = cd_0+cd$（**三项分别为面板攻击力的绿字/白字、面板暴击率和面板暴击伤害**），该问题可以化为：
$$
\begin{align}
\max & (1 + b') \times (1+cr'\times cd')  \\
\text{s.t. } & \frac{b'}{5\%} +\frac{cr'}{3.3\%} +\frac{cd'}{6.6\%} = T \\
& 5\% \le cr' \le 100\% \\
& cd' \ge 50\% 
\end{align}
$$

第二个边界条件表明暴击率不小于角色固有值5%，但大于100%的暴击率是溢出的；第三个边界条件表示最终的面板暴击伤害一定不小于角色固有值50%.



#### 求解和分析

这个最优化问题完全可以用计算机（如`JuMP.jl`）求数值解，如下图：

![optimal-allocation](https://humoon-image-hosting-service.oss-cn-beijing.aliyuncs.com/img/typora/2022/optimal-allocation.png)



但也可以推导和归纳出一些规律性的结论：

1. 若 $T \le 48.2$，除了角色固有的 50% 暴伤，不再给暴击和暴伤任何词条（最优暴击率为0），所有词条都尽量给百分比攻击。故此时角色应携带攻击头，而非暴击头。
2. 若 $48.2 < T < 56.41$，除了角色固有的 50% 暴伤，尽量不再给暴伤任何词条。最优暴击率 $cr'=1.65\%T-0.795 < 13.58\%$，最优的攻击绿字/白字 $b'=2.5\%T+0.826$。此时也应携带攻击头（暴击头会溢出），暴击率由圣遗物的副词条提供。
3. 若 $56.41 < T < 86.06$，最优的攻击绿字/白字 $b' = (0.1T-1-\sqrt{(1+0.05T)^2-13.77})/3$. 剩余词条按照 $cr':cd'=1:2$ 的比例分配
4. 若 $T>86.06$，$cr'$ 应堆到 100%，最优暴伤 $cd' = 3.3\%T-0.84>200\%$，最优的攻击绿字/白字 $b'=2.5\%T-0.879>1.272$
5. 主 C 日常不吃 buff 时，$T$ 一般在 $[65, 80]$ 之间，对应的最优攻击力绿字/白字在 $[1.12, 1.2]$ 之间。如果在战场上吃满拐，$T$ 甚至能超过 100——但即使按照 100 计算，最优攻击力绿字/白字也不超过 1.62，还是在暴击率堆满 100% 的前提下。所以说，班尼特大招、宗室4、千岩4、攻击沙加攻后绿字/白字常常超过2，攻击力的溢出其实是非常严重的。
6. 行秋等副C，后期装备质量起来之后，一般也能保证 $T > 56.41$，因此其配装原则与主 C 是基本一致的：一般用攻击沙、双暴头。
7. 珐露珊、莫娜等辅助角色，优先功能性，再考虑输出。在保证充能循环的基础上，最后要进一步优化输出时，由于辅助的 $T$ 一般小于 56.41，所以在攻击头和暴击头中选择攻击头（带西风系列武器时除外，优先堆暴击率以触发西风特效为全队充能）。
8. 在新账号养成的前期，圣遗物星级较低、词条很少，即使主 C 和副 C，$T$ 可能也小于 56.41 甚至小于 48.2. 此时要使输出最大化，应统一携带攻击头而非暴击头，副词条无脑堆攻击。
9. 增幅、激化等反应，公式涉及精通，更为复杂，此处暂不考虑。
