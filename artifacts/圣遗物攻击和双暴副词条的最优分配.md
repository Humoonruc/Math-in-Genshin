[TOC]

#### 基础知识

已知，圣遗物副属性中，$百分比攻击加成:暴击率:暴击伤害$ 平均以 $1.5:1:2$ 的比例给出。

![5星圣遗物副词条的取值范围](https://humoon-image-hosting-service.oss-cn-beijing.aliyuncs.com/img/typora/2022/5星圣遗物副词条的取值范围.jpg)

一般将 5%的攻击加成、3.3%的暴击率、6.6%的暴击伤害、5%的生命加成、6.2%的防御加成、5.5%的充能、20的精通称为一个词条。

沙杯头三个位置的满级圣遗物的主词条基本都相当于9.4个对应的副词条，以此类推，可以**将 5% 的元素/物理伤害加成视为一个词条**。这样，每个20级沙杯头圣遗物都相当于含有 17.4 或 18.4 个词条（0级3词条或4词条）。

|            | 数值生命值 | 数值攻击力 | 百分比生命值 | 百分比攻击力 | 百分比防御力 | 元素精通 | 元素充能效率 | 物理伤害加成 | 元素伤害加成 | 暴击率 | 暴击伤害 | 治疗加成 |
| :--------: | :--------: | :--------: | :----------: | :----------: | :----------: | :------: | :----------: | :----------: | :----------: | :----: | :------: | :------: |
| **等级20** |    4780    |    311     |    46.6%     |    46.6%     |    58.3%     |   187    |    51.8%     |    58.3%     |    46.6%     | 31.1%  |  62.2%   |  35.9%   |

圣遗物词条的最优分配问题，就是如何配置圣遗物的主副词条，使伤害最大化的问题。



#### 建模

不考虑元素反应打纯伤时，为了最大化输出，圣遗物词条最优化分配问题的建模如下：

设基础攻击力为 $a_0$，圣遗物百分比攻击加成为 $b$，圣遗物以外的所有攻击力增加为 $a_f$（圣遗物加的固定攻击可以忽略）。同样可以定义装备圣遗物之前的暴击率 $cr_0$、暴击伤害 $cd_0$、伤害加成 $db_0$，和圣遗物所给的暴击率 $cr$、暴击伤害 $cd$、伤害加成 $db$。**圣遗物词条中双暴、百分比攻击、伤害加成的总词条数为 $C$**，则伤害的最优化问题为：  
$$
\begin{align}
\max & D = [a_0 \times (1 + b) + a_f] \times \left[1+(cr_0+cr)\times (cd_0+cd)\right] \times (1+db_0+db) \tag{1} \\
\text{s.t. } & \frac{b}{5\%} +\frac{cr}{3.3\%} +\frac{cd}{6.6\%} = C \tag{2}
\end{align}
$$

经过简单的换元：$b'=b+a_f/a_0, cr' = cr_0+cr, cd' = cd_0+cd, db' = db_0+db$（**它们分别是面板攻击力的绿字/白字、面板暴击率、面板暴击伤害和面板伤害加成**），该问题可以化为：
$$
\begin{align}
\max & (1 + b') \times (1+cr'\times cd') \times (1+db')  \\
\text{s.t. } & \frac{b'}{5\%} +\frac{cr'}{3.3\%} +\frac{cd'}{6.6\%} + \frac{db'}{5\%} = T \\
& 5\% \le cr' \le 100\% \\
& cd' \ge 50\% \\ 
& b' \ge 311/a_0
\end{align}
$$

$T$ 可以称为等效总词条数。

此外，第二个边界条件表明暴击率不小于角色固有值5%，但大于100%的暴击率是溢出的；第三个边界条件表示最终的面板暴击伤害一定不小于角色固有值50%；第四个边界条件表示攻击绿字至少会包含羽毛的 311. 此外还应有伤害加成的边界条件，视角色和配装的不同无法统一写出。



#### 求解和分析

##### 例1：沙楼套0+1散兵单人纯风伤

这个最优化问题完全可以用计算机（如`JuMP.jl`）求数值解，如下图：

![artifact-stats-wanderer-single](https://humoon-image-hosting-service.oss-cn-beijing.aliyuncs.com/img/typora/2022/artifact-stats-wanderer-single.png)

1. 伤害加成：$T < 86.2$ 时，代表伤害加成的紫线始终保持在上限值，表明该项尚未被严重稀释，只要有条件就要堆满，所以必带风伤杯。$T > 86.2$ 时，伤害加成与百分比攻击曲线重合，表明二者被稀释的程度是相同的。是否带风伤杯不一定。
   1. $T=93$ 时，**在满足最优双暴的前提下**，攻击杯要比风伤杯好。
   2. $T = 110$ 时，**在满足最优双暴的前提下**，风伤杯要比攻击杯好。
   3. 但在双暴不达标时，往往有更多词条歪在了百分比攻击上，可能导致百分比攻击的稀释程度高于伤害加成。用什么杯需要具体计算。
2. 双暴：
   1. $T \le 81$，除了角色固有的 5% 暴击、50% 暴伤，不应再堆叠任何双暴词条。除了风伤杯，所有词条都尽量给到百分比攻击。故**此时角色应携带攻击头**。
   2. 若 $81 < T < 86.2$，除了角色固有的 50% 暴伤，不应再堆叠任何暴伤词条。**此时也应携带攻击头**（暴击头会溢出），暴击率由歪出来的副词条提供。
   3. 若 $86.2 < T < 111.6$，应携带双暴头，将暴击率堆到 67% 以上。双暴词条按照 $cr':cd'=1:2$ 的比例分配。
   4. 若 $T>111.6$，暴击率应堆到 100%，暴伤堆到 200% 以上。
3. 主 C 的 $T$ 一般大于 86.2，应佩戴双暴头。行秋等副C，后期装备质量起来之后，一般也能保证 $T > 86.2$，其配装原则与主 C 是基本一致的。
4. 珐露珊等辅助角色，优先功能性，再考虑输出，一般要堆充能保证循环。在此基础上需要进一步优化输出时，由于辅助的 $T$ 一般小于 86.2，应佩戴攻击头（带西风系列武器时除外，优先堆暴击率以触发西风特效）。
5. 在新账号养成的前期，圣遗物星级较低、词条很少，即使主 C，$T$ 可能也小于 86.2 甚至小于 81. 此时要使输出最大化，应统一携带攻击头而非暴击头，副词条无脑堆攻击。
6. 增幅、激化等反应，公式涉及精通，更为复杂，此处暂不考虑。



##### 例2：散珐班组队中的沙楼套0+1散兵

如下图：

![artifact-stats-wanderer-team](https://humoon-image-hosting-service.oss-cn-beijing.aliyuncs.com/img/typora/2022/artifact-stats-wanderer-team.png)

1. 攻击溢出严重，圣遗物副词条最好不要再歪攻击。
   1. 图中可见：$T > 165$ 后，单纯堆双暴也开始溢出，此时再堆一点攻击才是必要的。但这相当于在目前情况（$T = 146$，圣遗物提供了 24 个百分比攻击、双暴副词条）的基础上增加 19 个词条，达到 43 词条，即平均每个圣遗物要提供 8 个以上的副词条，且全部为双暴。考虑到 0 级圣遗物胚子最多有两个双暴副词条，即使**后续 5 次强化一次都不歪**，最多也只有 7 个双暴副词条。所以上述双暴稀释过于严重的条件是不可能达到的。
   2. 因此双暴的被稀释情况永远好于百分比攻击，每个圣遗物出 7 个双暴副词条永远是最优的。
2. 暴击率越高越好，往100%堆。
3. $T \le 155.4$ 时，相比双暴，伤害加成是有些溢出的。特别是$T \le 136.6$ 时，理论上不应带风伤杯，而应将这 9.4 个伤害加成词条换成双暴。但实际上没有双暴杯，因此相比被稀释得更加严重的百分比攻击，只能带风伤杯。
4. 结论：攻击沙、风伤杯、双暴头，每个圣遗物胚子都拥有百分比攻击、双暴副词条，后续 5 次强化全部歪双暴，且保证暴击率刚好堆到 100%、暴伤为暴击的 2 倍以上，为最优解。
